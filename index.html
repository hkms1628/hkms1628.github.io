<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>詩詞配對小遊戲</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft JhengHei', 'Segoe UI', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            border-bottom: 5px solid #8a7fcc;
        }
        
        h1 {
            color: #5a4fcf;
            font-size: 2.8rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .subtitle {
            color: #666;
            font-size: 1.2rem;
            margin-bottom: 20px;
        }
        
        .game-info {
            display: flex;
            justify-content: space-between;
            background-color: #fff;
            padding: 15px 25px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }
        
        .info-item {
            text-align: center;
        }
        
        .info-label {
            font-size: 0.9rem;
            color: #777;
            margin-bottom: 5px;
        }
        
        .info-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #5a4fcf;
        }
        
        .game-container {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .column {
            flex: 1;
            min-width: 300px;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }
        
        .column h2 {
            text-align: center;
            margin-bottom: 20px;
            color: #5a4fcf;
            padding-bottom: 10px;
            border-bottom: 2px dashed #ddd;
        }
        
        .poem-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .poem-item {
            padding: 18px;
            background-color: #f9f9ff;
            border-radius: 10px;
            cursor: move;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            font-size: 1.1rem;
            line-height: 1.5;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.05);
        }
        
        .poem-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(90, 79, 207, 0.15);
            border-color: #8a7fcc;
        }
        
        .poem-item.matched {
            background-color: #e8f5e9;
            color: #2e7d32;
            border-color: #4caf50;
            cursor: default;
        }
        
        .poem-item.incorrect {
            background-color: #ffebee;
            color: #c62828;
            border-color: #f44336;
            animation: shake 0.5s;
        }
        
        @keyframes shake {
            0%, 100% {transform: translateX(0);}
            25% {transform: translateX(-5px);}
            75% {transform: translateX(5px);}
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .btn-primary {
            background-color: #5a4fcf;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #463ca8;
            transform: translateY(-3px);
            box-shadow: 0 7px 14px rgba(90, 79, 207, 0.3);
        }
        
        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background-color: #545b62;
            transform: translateY(-3px);
            box-shadow: 0 7px 14px rgba(108, 117, 125, 0.3);
        }
        
        .btn-success {
            background-color: #4caf50;
            color: white;
        }
        
        .btn-success:hover {
            background-color: #3d8b40;
            transform: translateY(-3px);
            box-shadow: 0 7px 14px rgba(76, 175, 80, 0.3);
        }
        
        .difficulty-selector {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .difficulty-btn {
            padding: 10px 20px;
            border: 2px solid #5a4fcf;
            background-color: white;
            color: #5a4fcf;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }
        
        .difficulty-btn.active {
            background-color: #5a4fcf;
            color: white;
        }
        
        .difficulty-btn:hover {
            transform: translateY(-3px);
        }
        
        .instructions {
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }
        
        .instructions h3 {
            color: #5a4fcf;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .instructions ol {
            padding-left: 20px;
            line-height: 1.8;
        }
        
        .instructions li {
            margin-bottom: 10px;
        }
        
        .poem-author {
            font-style: italic;
            color: #666;
            font-size: 0.9rem;
            margin-top: 8px;
            text-align: right;
        }
        
        .match-feedback {
            text-align: center;
            font-size: 1.2rem;
            font-weight: bold;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            opacity: 0;
            transition: opacity 0.5s;
        }
        
        .match-feedback.show {
            opacity: 1;
        }
        
        .correct-feedback {
            background-color: #e8f5e9;
            color: #2e7d32;
        }
        
        .incorrect-feedback {
            background-color: #ffebee;
            color: #c62828;
        }
        
        @media (max-width: 768px) {
            .game-container {
                flex-direction: column;
            }
            
            h1 {
                font-size: 2.2rem;
            }
            
            .game-info {
                flex-direction: column;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-pen-nib"></i> 詩詞配對小遊戲</h1>
            <p class="subtitle">通過配對詩詞上下句，學習中華傳統文化經典</p>
        </header>
        
        <div class="difficulty-selector">
            <button class="difficulty-btn active" data-difficulty="easy">初級 (五言絕句)</button>
            <button class="difficulty-btn" data-difficulty="medium">中級 (七言絕句)</button>
            <button class="difficulty-btn" data-difficulty="hard">高級 (詞曲選段)</button>
        </div>
        
        <div class="game-info">
            <div class="info-item">
                <div class="info-label">得分</div>
                <div class="info-value" id="score">0</div>
            </div>
            <div class="info-item">
                <div class="info-label">剩餘配對</div>
                <div class="info-value" id="remaining">5</div>
            </div>
            <div class="info-item">
                <div class="info-label">正確率</div>
                <div class="info-value" id="accuracy">0%</div>
            </div>
            <div class="info-item">
                <div class="info-label">用時</div>
                <div class="info-value" id="timer">60s</div>
            </div>
        </div>
        
        <div class="match-feedback" id="feedback"></div>
        
        <div class="game-container">
            <div class="column">
                <h2><i class="fas fa-quote-left"></i> 詩詞上句</h2>
                <div class="poem-list" id="first-lines">
                    <!-- 詩詞上句將通過JS動態生成 -->
                </div>
            </div>
            
            <div class="column">
                <h2><i class="fas fa-quote-right"></i> 詩詞下句</h2>
                <div class="poem-list" id="second-lines">
                    <!-- 詩詞下句將通過JS動態生成 -->
                </div>
            </div>
        </div>
        
        <div class="controls">
            <button class="btn btn-primary" id="check-btn">
                <i class="fas fa-check-circle"></i> 檢查配對
            </button>
            <button class="btn btn-secondary" id="hint-btn">
                <i class="fas fa-lightbulb"></i> 提示
            </button>
            <button class="btn btn-success" id="next-round-btn">
                <i class="fas fa-forward"></i> 下一關
            </button>
            <button class="btn btn-secondary" id="reset-btn">
                <i class="fas fa-redo"></i> 重新開始
            </button>
        </div>
        
        <div class="instructions">
            <h3><i class="fas fa-info-circle"></i> 遊戲說明</h3>
            <ol>
                <li>從左側選擇一句詩詞上句，然後從右側選擇你認為匹配的下句</li>
                <li>點擊「檢查配對」按鈕驗證你的選擇是否正確</li>
                <li>正確配對一組詩詞可得20分，錯誤配對會扣除5分</li>
                <li>使用「提示」按鈕可以獲得幫助（每局遊戲限用3次）</li>
                <li>完成所有配對後，可以進入下一關或選擇其他難度</li>
                <li>遊戲目標：在最短時間內獲得最高分數！</li>
            </ol>
        </div>
    </div>

    <script>
        // 詩詞數據庫
        const poemDatabase = {
            easy: [
                {
                    first: "床前明月光",
                    second: "疑是地上霜",
                    author: "李白《靜夜思》"
                },
                {
                    first: "白日依山盡",
                    second: "黃河入海流",
                    author: "王之渙《登鸛雀樓》"
                },
                {
                    first: "春眠不覺曉",
                    second: "處處聞啼鳥",
                    author: "孟浩然《春曉》"
                },
                {
                    first: "紅豆生南國",
                    second: "春來發幾枝",
                    author: "王維《相思》"
                },
                {
                    first: "鋤禾日當午",
                    second: "汗滴禾下土",
                    author: "李紳《憫農》"
                }
            ],
            medium: [
                {
                    first: "朝辭白帝彩雲間",
                    second: "千里江陵一日還",
                    author: "李白《早發白帝城》"
                },
                {
                    first: "兩個黃鸝鳴翠柳",
                    second: "一行白鷺上青天",
                    author: "杜甫《絕句》"
                },
                {
                    first: "故人西辭黃鶴樓",
                    second: "煙花三月下揚州",
                    author: "李白《黃鶴樓送孟浩然之廣陵》"
                },
                {
                    first: "月落烏啼霜滿天",
                    second: "江楓漁火對愁眠",
                    author: "張繼《楓橋夜泊》"
                },
                {
                    first: "清明時節雨紛紛",
                    second: "路上行人欲斷魂",
                    author: "杜牧《清明》"
                }
            ],
            hard: [
                {
                    first: "明月幾時有",
                    second: "把酒問青天",
                    author: "蘇軾《水調歌頭》"
                },
                {
                    first: "大江東去",
                    second: "浪淘盡，千古風流人物",
                    author: "蘇軾《念奴嬌·赤壁懷古》"
                },
                {
                    first: "尋尋覓覓",
                    second: "冷冷清清，淒淒慘慘戚戚",
                    author: "李清照《聲聲慢》"
                },
                {
                    first: "問君能有幾多愁",
                    second: "恰似一江春水向東流",
                    author: "李煜《虞美人》"
                },
                {
                    first: "枯藤老樹昏鴉",
                    second: "小橋流水人家",
                    author: "馬致遠《天淨沙·秋思》"
                }
            ]
        };

        // 遊戲狀態變量
        let currentDifficulty = 'easy';
        let score = 0;
        let correctMatches = 0;
        let totalMatches = 5;
        let hintsUsed = 0;
        let maxHints = 3;
        let timeLeft = 60;
        let timerInterval;
        let selectedFirstLine = null;
        let selectedSecondLine = null;
        let matchedPairs = [];
        let currentPoems = [];

        // DOM元素
        const firstLinesContainer = document.getElementById('first-lines');
        const secondLinesContainer = document.getElementById('second-lines');
        const scoreElement = document.getElementById('score');
        const remainingElement = document.getElementById('remaining');
        const accuracyElement = document.getElementById('accuracy');
        const timerElement = document.getElementById('timer');
        const feedbackElement = document.getElementById('feedback');
        const checkBtn = document.getElementById('check-btn');
        const hintBtn = document.getElementById('hint-btn');
        const nextRoundBtn = document.getElementById('next-round-btn');
        const resetBtn = document.getElementById('reset-btn');
        const difficultyButtons = document.querySelectorAll('.difficulty-btn');

        // 初始化遊戲
        function initGame() {
            // 重置遊戲狀態
            score = 0;
            correctMatches = 0;
            hintsUsed = 0;
            timeLeft = 60;
            selectedFirstLine = null;
            selectedSecondLine = null;
            matchedPairs = [];
            
            // 獲取當前難度的詩詞
            currentPoems = [...poemDatabase[currentDifficulty]];
            
            // 更新UI
            updateScore();
            updateTimer();
            
            // 停止之前的計時器
            if (timerInterval) clearInterval(timerInterval);
            
            // 開始新計時器
            startTimer();
            
            // 渲染詩詞選項
            renderPoemOptions();
            
            // 隱藏反饋
            hideFeedback();
            
            // 更新按鈕狀態
            hintBtn.disabled = false;
            nextRoundBtn.disabled = true;
        }

        // 開始計時器
        function startTimer() {
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimer();
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    endGame();
                }
            }, 1000);
        }

        // 更新計時器顯示
        function updateTimer() {
            timerElement.textContent = `${timeLeft}s`;
            
            // 時間不足時改變顏色
            if (timeLeft <= 10) {
                timerElement.style.color = '#f44336';
            } else {
                timerElement.style.color = '#5a4fcf';
            }
        }

        // 更新分數顯示
        function updateScore() {
            scoreElement.textContent = score;
            
            const remaining = totalMatches - correctMatches;
            remainingElement.textContent = remaining;
            
            const accuracy = correctMatches === 0 ? 0 : Math.round((correctMatches / totalMatches) * 100);
            accuracyElement.textContent = `${accuracy}%`;
            
            // 如果所有配對完成，啟用下一關按鈕
            if (correctMatches === totalMatches) {
                nextRoundBtn.disabled = false;
                clearInterval(timerInterval);
            }
        }

        // 渲染詩詞選項
        function renderPoemOptions() {
            // 清空容器
            firstLinesContainer.innerHTML = '';
            secondLinesContainer.innerHTML = '';
            
            // 創建詩詞上句選項
            currentPoems.forEach((poem, index) => {
                const firstLineElement = document.createElement('div');
                firstLineElement.className = 'poem-item';
                firstLineElement.textContent = poem.first;
                firstLineElement.dataset.id = index;
                
                // 檢查是否已匹配
                if (matchedPairs.includes(index)) {
                    firstLineElement.classList.add('matched');
                    firstLineElement.innerHTML = `
                        ${poem.first}
                        <div class="poem-author">${poem.author}</div>
                    `;
                } else {
                    firstLineElement.addEventListener('click', () => selectFirstLine(index));
                }
                
                firstLinesContainer.appendChild(firstLineElement);
            });
            
            // 創建詩詞下句選項（隨機順序）
            const secondLines = currentPoems.map(poem => poem.second);
            shuffleArray(secondLines);
            
            secondLines.forEach((line, index) => {
                const secondLineElement = document.createElement('div');
                secondLineElement.className = 'poem-item';
                secondLineElement.textContent = line;
                secondLineElement.dataset.line = line;
                
                // 檢查是否已匹配
                const matchedIndex = currentPoems.findIndex(poem => 
                    poem.second === line && matchedPairs.includes(currentPoems.indexOf(poem))
                );
                
                if (matchedIndex !== -1) {
                    secondLineElement.classList.add('matched');
                    secondLineElement.innerHTML = `
                        ${line}
                        <div class="poem-author">${currentPoems[matchedIndex].author}</div>
                    `;
                } else {
                    secondLineElement.addEventListener('click', () => selectSecondLine(line));
                }
                
                secondLinesContainer.appendChild(secondLineElement);
            });
            
            // 清除之前的選擇
            clearSelections();
        }

        // 選擇詩詞上句
        function selectFirstLine(index) {
            // 清除之前的上句選擇
            document.querySelectorAll('#first-lines .poem-item:not(.matched)').forEach(item => {
                item.style.borderColor = 'transparent';
                item.style.backgroundColor = '#f9f9ff';
            });
            
            // 設置當前選擇
            selectedFirstLine = index;
            const selectedElement = document.querySelector(`#first-lines .poem-item[data-id="${index}"]:not(.matched)`);
            
            if (selectedElement) {
                selectedElement.style.borderColor = '#5a4fcf';
                selectedElement.style.backgroundColor = '#e8e6ff';
            }
        }

        // 選擇詩詞下句
        function selectSecondLine(line) {
            // 清除之前的下句選擇
            document.querySelectorAll('#second-lines .poem-item:not(.matched)').forEach(item => {
                item.style.borderColor = 'transparent';
                item.style.backgroundColor = '#f9f9ff';
            });
            
            // 設置當前選擇
            selectedSecondLine = line;
            const selectedElement = document.querySelector(`#second-lines .poem-item[data-line="${line}"]:not(.matched)`);
            
            if (selectedElement) {
                selectedElement.style.borderColor = '#5a4fcf';
                selectedElement.style.backgroundColor = '#e8e6ff';
            }
        }

        // 清除選擇
        function clearSelections() {
            selectedFirstLine = null;
            selectedSecondLine = null;
            
            document.querySelectorAll('.poem-item:not(.matched)').forEach(item => {
                item.style.borderColor = 'transparent';
                item.style.backgroundColor = '#f9f9ff';
            });
        }

        // 檢查配對
        function checkMatch() {
            if (selectedFirstLine === null || selectedSecondLine === null) {
                showFeedback('請先選擇一組上下句進行配對', 'incorrect');
                return;
            }
            
            const selectedPoem = currentPoems[selectedFirstLine];
            const isCorrect = selectedPoem.second === selectedSecondLine;
            
            if (isCorrect) {
                // 正確配對
                score += 20;
                correctMatches++;
                matchedPairs.push(selectedFirstLine);
                
                showFeedback('配對正確！ +20分', 'correct');
                renderPoemOptions();
                updateScore();
                
                // 檢查遊戲是否結束
                if (correctMatches === totalMatches) {
                    showFeedback(`恭喜！你已完成所有配對！總分：${score}分`, 'correct');
                }
            } else {
                // 錯誤配對
                score = Math.max(0, score - 5);
                
                // 顯示錯誤動畫
                const firstElement = document.querySelector(`#first-lines .poem-item[data-id="${selectedFirstLine}"]`);
                const secondElement = document.querySelector(`#second-lines .poem-item[data-line="${selectedSecondLine}"]`);
                
                if (firstElement) firstElement.classList.add('incorrect');
                if (secondElement) secondElement.classList.add('incorrect');
                
                showFeedback('配對錯誤，請再試一次 -5分', 'incorrect');
                
                // 移除錯誤動畫
                setTimeout(() => {
                    if (firstElement) firstElement.classList.remove('incorrect');
                    if (secondElement) secondElement.classList.remove('incorrect');
                    clearSelections();
                }, 1000);
                
                updateScore();
            }
        }

        // 顯示提示
        function giveHint() {
            if (hintsUsed >= maxHints) {
                showFeedback('提示已用完！', 'incorrect');
                hintBtn.disabled = true;
                return;
            }
            
            // 找到一個未匹配的詩句
            const unmatchedIndices = currentPoems
                .map((_, index) => index)
                .filter(index => !matchedPairs.includes(index));
            
            if (unmatchedIndices.length === 0) {
                showFeedback('所有詩句都已配對完成！', 'correct');
                return;
            }
            
            const randomIndex = unmatchedIndices[Math.floor(Math.random() * unmatchedIndices.length)];
            const hintPoem = currentPoems[randomIndex];
            
            // 高亮顯示正確的上句
            const firstElement = document.querySelector(`#first-lines .poem-item[data-id="${randomIndex}"]:not(.matched)`);
            if (firstElement) {
                firstElement.style.borderColor = '#4caf50';
                firstElement.style.backgroundColor = '#e8f5e9';
                firstElement.style.boxShadow = '0 0 10px rgba(76, 175, 80, 0.5)';
                
                // 3秒後恢復
                setTimeout(() => {
                    if (!firstElement.classList.contains('matched')) {
                        firstElement.style.borderColor = 'transparent';
                        firstElement.style.backgroundColor = '#f9f9ff';
                        firstElement.style.boxShadow = '0 3px 8px rgba(0, 0, 0, 0.05)';
                    }
                }, 3000);
            }
            
            hintsUsed++;
            showFeedback(`提示：${hintPoem.first} 配對 ${hintPoem.second}`, 'correct');
            
            // 更新提示按鈕
            hintBtn.innerHTML = `<i class="fas fa-lightbulb"></i> 提示 (${maxHints - hintsUsed}次)`;
            
            if (hintsUsed >= maxHints) {
                hintBtn.disabled = true;
            }
        }

        // 顯示反饋
        function showFeedback(message, type) {
            feedbackElement.textContent = message;
            feedbackElement.className = `match-feedback show ${type}-feedback`;
            
            setTimeout(hideFeedback, 3000);
        }

        // 隱藏反饋
        function hideFeedback() {
            feedbackElement.classList.remove('show');
        }

        // 下一關
        function nextRound() {
            // 增加難度循環
            const difficulties = ['easy', 'medium', 'hard'];
            const currentIndex = difficulties.indexOf(currentDifficulty);
            const nextIndex = (currentIndex + 1) % difficulties.length;
            
            // 更新難度按鈕
            difficultyButtons.forEach(btn => btn.classList.remove('active'));
            difficultyButtons[nextIndex].classList.add('active');
            
            // 設置新難度
            currentDifficulty = difficulties[nextIndex];
            
            // 重新初始化遊戲
            initGame();
            
            showFeedback(`進入${getDifficultyName(currentDifficulty)}難度！`, 'correct');
        }

        // 結束遊戲
        function endGame() {
            showFeedback(`時間到！你的最終得分：${score}分`, 'incorrect');
            hintBtn.disabled = true;
            checkBtn.disabled = true;
        }

        // 獲取難度名稱
        function getDifficultyName(difficulty) {
            const names = {
                easy: '初級',
                medium: '中級',
                hard: '高級'
            };
            return names[difficulty];
        }

        // 工具函數：隨機打亂數組
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // 事件監聽器
        checkBtn.addEventListener('click', checkMatch);
        hintBtn.addEventListener('click', giveHint);
        nextRoundBtn.addEventListener('click', nextRound);
        resetBtn.addEventListener('click', initGame);

        // 難度選擇按鈕
        difficultyButtons.forEach(button => {
            button.addEventListener('click', () => {
                difficultyButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                currentDifficulty = button.dataset.difficulty;
                initGame();
            });
        });

        // 初始化遊戲
        document.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>